{% load static %}

<!doctype html>
<html class="sidebar-left-big-icons">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
	<title>Araçlar</title>

	<!-- Vendor CSS -->
	<link rel="stylesheet" href="{% static 'vendor/bootstrap/css/bootstrap.css' %}">
	<link rel="stylesheet" href="{% static 'vendor/font-awesome/css/all.min.css' %}">

	<!-- Theme CSS -->
	<link rel="stylesheet" href="{% static 'vendor/morris/morris.css' %}">
	<link rel="stylesheet" href="{% static 'css/theme.css' %}">
	<link rel="stylesheet" href="{% static 'css/skins/default.css' %}">
	<link rel="stylesheet" href="{% static 'css/custom.css' %}">
	<link rel="stylesheet" href="{% static 'iziTots/css/iziToast.min.css' %}">
	<link rel="stylesheet" href="{% static '_dataTable/datatables.min.css' %}">
	<link rel="stylesheet" href="{% static '_dataTable/tableCategory/table.css' %}">
	<link rel="stylesheet" href="{% static 'vendor/bootstrap-datepicker/css/bootstrap-datepicker3.css' %}">




</head>

<body>
	<input type="hidden" id="updateId">
	<section class="body">
		<!-- start: header -->
		<header class="header" id="header">
		</header>
		<!-- end: header -->

		<div class="inner-wrapper">
			<!-- start: sidebar -->
			<aside id="sidebar-left" class="sidebar-left">
			</aside>
			<!-- end: sidebar -->


			<section role="main" class="content-body">
				<header class="page-header"></header>
				<!-- start: page -->






				<section>
					<div class="card card-modern mt-2">
						<div class="card-body">
							<div class="row g-2">

								<div class="col-lg-2">
									<button class="btn btn-primary w-100" data-bs-toggle="modal"
										data-bs-target="#ModalAdd">
										Araç Ekle
										<i class="fa-solid fa-send-back mx-1"></i>
									</button>
								</div>


							</div>

						</div>
					</div>
				</section>

				<section>
					<div class="card card-modern mt-2">
						<div class="card-body pt-4 card-table">


							<div class="table-resonsive position-relative">
								<table id="example" class="display table  table-striped table-bordered"
									style="width:100%">
									<thead class="bg-dark text-white table-head-position-sticky">
										<tr>

											<!-- <th style="width: 7px;"></th> -->
											<th style="width: 7px;"></th>

											<th>Ad</th>
											<th>Soyad</th>
											<th>mail</th>


											<th style="width: 200px;"></th>

										</tr>
									</thead>
									<tbody></tbody>
									<!-- <tfoot>
										<tr>
											<th></th>
											<th></th>
											<th>Sözleşme No</th>
											<th>1</th>
											<th>2</th>
											<th>3</th>
											<th>date</th>
										</tr>
									</tfoot> -->
								</table>
							</div>



						</div>
					</div>
				</section>











				<!-- end: page -->
			</section>
		</div>
	</section>


















	<div class="modal fade" id="ModalAdd" tabindex="-1">
		<div class="modal-dialog modal-lg">
			<div class="modal-content">
				<div class="modal-header bg-primary text-white py-3">
					<h1 class="modal-title fs-5 mt-0" id="exampleModalLabel"></h1>
					<button type="button" class="btn-close text-white" data-bs-dismiss="modal"
						aria-label="Close"></button>
				</div>
				<div class="modal-body py-4 position-relative">
					<div class="search-content m-0">
						<form id="FormAdd" class="row">
		
							<div class="col-md-6">
								<div class="mb-3">
									<label class="form-label">Ad</label>
									<input type="text" class="form-control" required id="name">
								</div>
							</div>

							<div class="col-md-6">
								<div class="mb-3">
									<label class="form-label">Fiyat</label>
									<input type="number" class="form-control" required id="price">
								</div>
							</div>
							<div class="col-md-6">
								<div class="mb-3">
									<label class="form-label">Geçmiş Fiyat</label>
									<input type="number" class="form-control" required id="previousPrice">
								</div>
							</div>
	
							<div class="col-md-6">
								<div class="mb-3">
									<label class="form-label">Marka</label>
									<input type="text" class="form-control" required id="brand">
								</div>
							</div>
					
							<div class="col-md-6">

								<div class="mb-3">
									<label class="form-label">Resim</label>
									<input type="text" class="form-control" required id="uavMedia">
								</div>
							</div>
							<div class="col-md-6">
								<div class="mb-3">
									<label class="form-label">haberleşme mesafesi</label>
									<input type="number" class="form-control" placeholder="km" required id="comRange">
								</div>
							</div>
							<div class="col-md-6">
								<div class="mb-3">
									<label class="form-label">Mühimmat</label>
									<input type="text" class="form-control" required id="ammunition">
								</div>
							</div>
							<div class="col-md-6">
								<div class="mb-3">
									<label class="form-label">dayanıklılık</label>
									<input type="number" class="form-control"  required  placeholder="saat" id="endurance">
								</div>
							</div>
							<div class="col-md-6">
								<div class="mb-3">
									<label class="form-label">Seyahat hızı</label>
									<input type="number" class="form-control" placeholder="knot"  required id="travelSpeed">
								</div>
							</div>
							<div class="col-md-6">
								<div class="mb-3">
									<label class="form-label">yakıt kapasitesi</label>
									<input type="number" class="form-control"required placeholder="kg" id="fuelCapacity">
								</div>
							</div>
							<div class="col-md-6">
								<div class="mb-3">
									<label class="form-label">Operasyonal İrtifa</label>
									<input type="number" class="form-control" required id="operationalAttitude">
								</div>
							</div>
							<div class="col-md-6">
								<div class="mb-3">
									<label class="form-label">Yük Kapasitesi</label>
									<input type="number" class="form-control" required id="payloadCapacity" >
								</div>
							</div>
							<div class="col-md-6">
								<div class="mb-3">
									<label class="form-label">Depozito</label>
									<input type="number" class="form-control" required id="deposit">
								</div>
							</div>
							<div class="col-md-6">
								<div class="mb-3">
									<label>Kategori</label>
									<select id="categoryId" class="form-control" required>

										<!-- <option value="">dedsd</option> -->
									</select>
								</div>
							</div>
							<div class="col-md-12">
								<div class="mb-3">
									<label class="form-label">Açıklama</label>
									<textarea id="desc" cols="30" rows="10" class="form-control"></textarea>
								</div>
							</div>
							<div class="col-12">
								<button type="submit" class="btn btn-success px-5">Ekle</button>
							</div>

						</form>

					</div>
				</div>
			</div>
		</div>
	</div>

	<div class="modal fade" id="ModalUpdate" tabindex="-1">
		<div class="modal-dialog modal-lg">
			<div class="modal-content">
				<div class="modal-header bg-primary text-white py-3">
					<h1 class="modal-title fs-5 mt-0" id="exampleModalLabel"></h1>
					<button type="button" class="btn-close text-white" data-bs-dismiss="modal"
						aria-label="Close"></button>
				</div>
				<div class="modal-body py-4 position-relative">
					<div class="search-content m-0">
						<form id="FormUpdate" class="row">
								<div class="col-md-6">
								<div class="mb-3">
									<label class="form-label">Ad</label>
									<input type="text" class="form-control" required id="nameUpdate">
								</div>
							</div>
							
							<div class="col-md-6">
								<div class="mb-3">
									<label class="form-label">Fiyat</label>
									<input type="number" class="form-control" required id="priceUpdate">
								</div>
							</div>
							<div class="col-md-6">
								<div class="mb-3">
									<label class="form-label">Geçmiş Fiyat</label>
									<input type="number" class="form-control" required id="previousPriceUpdate">
								</div>
							</div>
	
							<div class="col-md-6">
								<div class="mb-3">
									<label class="form-label">Marka</label>
									<input type="text" class="form-control" required id="brandUpdate">
								</div>
							</div>
					
							<div class="col-md-6">

								<div class="mb-3">
									<label class="form-label">Resim</label>
									<input type="text" class="form-control" required id="uavMediaUpdate">
								</div>
							</div>
							<div class="col-md-6">
								<div class="mb-3">
									<label class="form-label">haberleşme mesafesi</label>
									<input type="number" class="form-control" placeholder="km" required id="comRangeUpdate">
								</div>
							</div>
							<div class="col-md-6">
								<div class="mb-3">
									<label class="form-label">Mühimmat</label>
									<input type="text" class="form-control" required id="ammunitionUpdate">
								</div>
							</div>
							<div class="col-md-6">
								<div class="mb-3">
									<label class="form-label">dayanıklılık</label>
									<input type="number" class="form-control"  required  placeholder="saat" id="enduranceUpdate">
								</div>
							</div>
							<div class="col-md-6">
								<div class="mb-3">
									<label class="form-label">Seyahat hızı</label>
									<input type="number" class="form-control" placeholder="knot"  required id="travelSpeedUpdate">
								</div>
							</div>
							<div class="col-md-6">
								<div class="mb-3">
									<label class="form-label">yakıt kapasitesi</label>
									<input type="number" class="form-control"required placeholder="kg" id="fuelCapacityUpdate">
								</div>
							</div>
							<div class="col-md-6">
								<div class="mb-3">
									<label class="form-label">Operasyonal İrtifa</label>
									<input type="number" class="form-control" required id="operationalAttitudeUpdate">
								</div>
							</div>
							<div class="col-md-6">
								<div class="mb-3">
									<label class="form-label">Yük Kapasitesi</label>
									<input type="number" class="form-control" required id="payloadCapacityUpdate" >
								</div>
							</div>
							<div class="col-md-6">
								<div class="mb-3">
									<label class="form-label">Depozito</label>
									<input type="number" class="form-control" required id="depositUpdate">
								</div>
							</div>
							<div class="col-md-6">
								<div class="mb-3">
									<label>Kategori</label>
									<select id="categoryIdUpdate" class="form-control" required>

										<!-- <option value="">dedsd</option> -->
									</select>
								</div>
							</div>
							<div class="col-md-12">
								<div class="mb-3">
									<label class="form-label">Açıklama</label>
									<textarea id="descUpdate" cols="30" rows="10" class="form-control"></textarea>
								</div>
							</div>
							<div class="col-12">
								<button type="submit" class="btn btn-success px-5">Güncelle</button>
							</div>
						</form>

					</div>
				</div>
			</div>
		</div>
	</div>



	<!-- Vendor -->
	<script src="{% static 'vendor/jquery/jquery.js' %}"></script>
	<script src="{% static 'vendor/jquery-browser-mobile/jquery.browser.mobile.js' %}"></script>
	<script src="{% static 'vendor/nanoscroller/nanoscroller.js' %}"></script>
	<script src="{% static 'vendor/bootstrap/js/bootstrap.bundle.min.js' %}"></script>



	<script src="{% static 'vendor/popper/umd/popper.min.js' %}"></script>
	<script src="{% static 'vendor/modernizr/modernizr.js' %}"></script>



	<script src="{% static 'vendor/bootstrap-datepicker/js/bootstrap-datepicker.js' %}"></script>
	<script src="{% static 'vendor/common/common.js' %}"></script>


	<script src="{% static 'iziTots/js/iziToast.min.js' %}"></script>
	<script src="{% static 'iziTots/js/settings.js' %}"></script>

	<script src="{% static 'js/custom.js' %}"></script>
	<script src="{% static 'js/handlebars.min.js' %}"></script>
	<script src="{% static '_layout.js' %}"></script>


	<script src="{% static '_dataTable/datatables.min.js' %}"></script>
	<script src="https://cdn.datatables.net/fixedheader/3.1.9/js/dataTables.fixedHeader.min.js"></script>

	<!-- <script src="{% static '_dataTable/tableCategory/table.js' %}"></script> -->




	<script src="{% static 'js/theme.js' %}"></script>
	<script src="{% static 'js/theme.init.js' %}"></script>
	<script src="{% static 'js/examples/examples.advanced.form.js' %}"></script>


	<script>
		$(document).ready(function () {
			$.ajax({
				type: "GET",
				url: "/api/category/",
				success: function (response) {
					console.log(response);
					var select = $("#categoryId");
					var select2 = $("#categoryIdUpdate");
					select.append(`<option value="">Kategori Seçiniz</option>`);
					select2.append(`<option value="">Kategori Seçiniz</option>`);
					$.each(response, function (index, item) {
						select.append(`<option value="${item.id}">${item.name}</option>`);
						select2.append(`<option value="${item.id}">${item.name}</option>`);
					});
					
				}
			});


			data();


			$("body").on("click", ".btnUpdate", function (e) {
				e.preventDefault();
				var id = $(this).attr("data-id");
				$("#ModalUpdate").modal("show");
				$.ajax({
					type: "GET",
					url: "/api/uav/" + id + "/",
					success: function (response) {

						$("#nameUpdate").val(response.name);
						$("#priceUpdate").val(response.price);
						$("#previousPriceUpdate").val(response.previousPrice);
						$("#brandUpdate").val(response.brand);
						$("#uavMediaUpdate").val(response.uavMedia);
						$("#comRangeUpdate").val(response.comRange);
						$("#ammunitionUpdate").val(response.ammunition);
						$("#enduranceUpdate").val(response.endurance);
						$("#travelSpeedUpdate").val(response.travelSpeed);
						$("#fuelCapacityUpdate").val(response.fuelCapacity);
						$("#operationalAttitudeUpdate").val(response.operationalAttitude);
						$("#payloadCapacityUpdate").val(response.payloadCapacity);
						$("#depositUpdate").val(response.deposit);
						$("#descUpdate").val(response.desc);
						$("#categoryIdUpdate").val(response.categoryId);

						$("#updateId").val(response.id);

					},
					error: function (error) {
						console.error("Veri alınamadı!", error);
					}
				});
			});

			$("body").on("click", ".btnDelete", function (e) {
				e.preventDefault();
				var id = $(this).attr("data-id");

				var onay = confirm("Bu öğeyi silmek istediğinizden emin misiniz?");
				if (onay) {
					$.ajax({
						type: "DELETE",
						url: "/api/uav/" + id + "/",
						success: function (response) {
							// alert(response.name);
							data();
							iziToast.success({ timeout: 4000, icon: 'fas fa-check', title: 'Başarılı!', message: "Başarılı bir şekilde silindi" });

						},
						error: function (error) {
							console.error("Veri alınamadı!", error);
						}
					});
				}
			});
		});



		function data() {
			$.ajax({
				type: "GET",
				url: "/api/uav/",
				dataType: "json",
				success: function (response) {
					// Veriyi aldığımızda önce tablo içeriğini temizleyelim
					$("#example tbody").empty();

					// Her bir nesneyi tabloya ekleyelim
					$.each(response, function (index, item) {
						var row = "<tr>" +
							"<td>" + item.id + "</td>" +
							"<td>" + item.name + "</td>" +
							"<td>" + item.price + "</td>" +
							"<td>" + item.deposit + "</td>" +
							"<td>" + `
								<div class="row g-1">
									<div class="col-6"><button type="button" data-id="${item.id}" class="btn btn-primary w-100 btnUpdate">Güncelle</button></div>
									<div class="col-6"><button  type="button" data-id="${item.id}" class="btn btn-danger w-100 btnDelete">Sil</button></div>
								</div>`+
							"</td>" +
							"</tr>";

						$("#example tbody").append(row);
					});
				},
				error: function (error) {
					console.error("Veri alınamadı!", error);
				}
			});
		}









		$("#FormAdd").submit(function (e) {

			e.preventDefault();





			var request = {
				name: $("#name").val(),
				price: $("#price").val(),
				previousPrice: $("#previousPrice").val(),
				deposit: $("#deposit").val(),
				brand: $("#brand").val(),
				desc: $("#desc").val(),
				uavMedia: $("#uavMedia").val(),
				comRange: $("#comRange").val(),
				ammunition: $("#ammunition").val(),
				endurance: $("#endurance").val(),
				travelSpeed: $("#travelSpeed").val(),
				fuelCapacity: $("#fuelCapacity").val(),
				operationalAttitude: $("#operationalAttitude").val(),
				payloadCapacity: $("#payloadCapacity").val(),
				categoryId: $("#categoryId").val(),
				isRented: 0,
			};

			$.ajax({
				type: "POST",
				url: "/api/uav/",
				data: request,
				success: function (response) {





					$("#FormAdd").trigger("reset");
					$("#ModalAdd").modal("hide");
					iziToast.success({ timeout: 4000, icon: 'fas fa-check', title: 'Başarılı!', message: "Başarılı bir şekilde Eklendi" });
					data();



				},
				error: function (error) {
					console.log("Hata: ", error);
				}
			});

		});


		$("#FormUpdate").submit(function (e) {

			e.preventDefault();

			var id = $("#updateId").val();

			var request = {
			
				name: $("#nameUpdate").val(),
				price: $("#priceUpdate").val(),
				previousPrice: $("#previousPriceUpdate").val(),
				deposit: $("#depositUpdate").val(),
				brand: $("#brandUpdate").val(),
				desc: $("#descUpdate").val(),
				uavMedia: $("#uavMediaUpdate").val(),
				comRange: $("#comRangeUpdate").val(),
				ammunition: $("#ammunitionUpdate").val(),
				endurance: $("#enduranceUpdate").val(),
				travelSpeed: $("#travelSpeedUpdate").val(),
				fuelCapacity: $("#fuelCapacityUpdate").val(),
				operationalAttitude: $("#operationalAttitudeUpdate").val(),
				payloadCapacity: $("#payloadCapacityUpdate").val(),
				categoryId: $("#categoryIdUpdate").val(),
				isRented: 0,
			};

			$.ajax({
				type: "PUT",
				url: "/api/uav/" + id + "/",
				data: request,
				success: function (response) {

					$("#ModalUpdate").modal("hide");
					iziToast.success({ timeout: 4000, icon: 'fas fa-check', title: 'Başarılı!', message: "Başarılı bir şekilde güncellendi" });
					data();

				},
				error: function (error) {
					console.log("Hata: ", error);
				}
			});

		});
	</script>

</body>

</html>